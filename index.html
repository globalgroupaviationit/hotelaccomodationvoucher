<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hotel Accommodation Voucher Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background-color: #f5f5f5;
      padding: 20px;
      color: #333;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .form-section {
      background: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .form-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 20px;
      color: #2c3e50;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 14px;
      color: #555;
    }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #27ae60;
      box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
    }
    
    .booking-item, .transport-item {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #e9ecef;
    }
    
    .booking-header, .transport-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .booking-title, .transport-title {
      font-weight: 600;
      font-size: 16px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: #27ae60;
      color: white;
    }
    
    .btn-primary:hover {
      background: #219653;
    }
    
    .btn-danger {
      background: #e74c3c;
      color: white;
      padding: 8px 12px;
      font-size: 12px;
    }
    
    .btn-danger:hover {
      background: #c0392b;
    }
    
    .btn-export {
      padding: 12px 24px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 10px;
    }
    
    .btn-export i {
      font-size: 18px;
    }
    
    .btn-blue {
      background: #3498db;
      color: white;
    }
    
    .btn-blue:hover {
      background: #2980b9;
    }
    
    .btn-green {
      background: #27ae60;
      color: white;
    }
    
    .btn-green:hover {
      background: #219653;
    }
    
    .export-section {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px 0;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Voucher Styles */
    .voucher-container {
      background: white;
      border: 1px solid #ddd;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      margin: 30px auto;
      overflow: hidden;
      position: relative;
    }
    
    .voucher-header {
      background: #1a4d2e;
      color: white;
      text-align: center;
      padding: 30px 20px;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 1px;
      position: relative;
      z-index: 2;
    }
    
    .info-bar {
      background: #2b673c;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      position: relative;
      z-index: 2;
    }
    
    .info-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .info-item i {
      font-size: 16px;
    }
    
    .voucher-content {
      padding: 25px;
      position: relative;
      z-index: 2;
    }
    
    .voucher-row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      align-items: center;
    }
    
    .label {
      font-weight: 700;
      width: 220px; /* Increased slightly to accommodate longer labels */
      text-align: right;
    }
    
    .value {
      flex: 1;
      text-align: left;
    }
    
    .booking-details-header, .transport-details-header {
      background: #1a4d2e;
      color: white;
      text-align: center;
      padding: 12px 0;
      font-weight: 600;
      font-size: 16px;
      margin: 25px 0 20px 0;
      width: 100%;
      position: relative;
      z-index: 2;
    }
    
    .booking-table, .transport-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
      position: relative;
      z-index: 2;
    }
    
    .booking-table th, .booking-table td,
    .transport-table th, .transport-table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    
    .booking-table th, .transport-table th {
      background: #f8f9fa;
      font-weight: 600;
    }
    
    .policies-section {
      background: #f8f9fa;
      padding: 20px;
      margin-top: 20px;
      border-top: 2px solid #ddd;
      font-size: 10px;
      line-height: 1.4;
      position: relative;
      z-index: 2;
    }
    
    .policies-title {
      font-weight: 700;
      font-size: 12px;
      margin-bottom: 15px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .policy-item {
      margin-bottom: 8px;
    }
    
    .policy-number {
      font-weight: 700;
      margin-right: 5px;
    }
    
    .voucher-footer {
      height: 50px;
      background: #f8f9fa;
      position: relative;
      z-index: 2;
    }
    
    /* Large Background Watermark */
    .background-watermark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.03;
      z-index: 1;
      pointer-events: none;
    }
    
    .background-watermark img {
      max-width: 800px;
      height: auto;
    }
    
    /* Transport Sector Input */
    .sector-input-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .sector-input {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .add-sector-btn {
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 4px;
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    .add-sector-btn:hover {
      background: #219653;
    }
    
    .other-city-input {
      margin-top: 10px;
      display: none;
    }

    /* Added Note Style */
    .checkin-note {
      text-align: center;
      color: red;
      font-weight: 700;
      margin-top: 15px;
      font-size: 14px;
      position: relative;
      z-index: 2;
      text-transform: uppercase;
    }
    
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .voucher-row {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .label {
        width: 100%;
        text-align: left;
        margin-bottom: 5px;
      }
      
      .export-section {
        flex-direction: column;
        align-items: center;
      }
      
      .btn-export {
        width: 100%;
        justify-content: center;
      }
      
      .background-watermark img {
        max-width: 600px;
      }
      
      .policies-section {
        font-size: 9px;
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="form-section">
      <h2 class="form-title">Voucher Information</h2>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="clientName">Client Name</label>
          <input type="text" id="clientName" class="form-control" placeholder="Enter Client Name">
        </div>
        <div class="form-group">
          <label for="contactNo">Contact No.</label>
          <input type="text" id="contactNo" class="form-control" placeholder="Enter Contact Number">
        </div>
        <div class="form-group">
          <label for="pos">POS</label>
          <input type="text" id="pos" class="form-control" placeholder="Enter POS">
        </div>
        <div class="form-group">
          <label for="posContactNo">POS Contact No.</label>
          <input type="text" id="posContactNo" class="form-control" placeholder="Enter POS Contact Number">
        </div>
      </div>
      
      <h2 class="form-title">Booking Details</h2>
      <div id="bookings-container">
        </div>
      
      <button id="add-booking" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add Another Booking
      </button>
      
      <h2 class="form-title">Transport Details</h2>
      <div class="transport-item">
        <div class="transport-header">
          <div class="transport-title">Transport Information</div>
        </div>
        
        <div id="sectors-container">
          </div>
        
        <div class="form-grid" style="margin-top: 20px;">
          <div class="form-group">
            <label>Vehicle</label>
            <input type="text" id="transport-vehicle" class="form-control" placeholder="Enter Vehicle">
          </div>
          <div class="form-group">
            <label>Category</label>
            <select id="transport-category" class="form-control">
              <option value="Private">Private</option>
              <option value="Company">Company</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    
    <div class="voucher-container" id="voucher-preview">
      <div class="background-watermark">
        <img src="https://i.postimg.cc/7hCT9DpT/Global-Hajj-and-Umrah-Group-png-1.png" alt="Global Hajj Watermark">
      </div>
      
      <div class="voucher-header">
        HOTEL ACCOMODATION VOUCHER
      </div>
      
      <div class="info-bar">
        <div class="info-item">
          <i class="fas fa-globe"></i>
          <span>www.globalhajj.com</span>
        </div>
        <div class="info-item">
          <i class="fas fa-phone"></i>
          <span>+92 300 9071 808</span>
        </div>
        <div class="info-item">
          <i class="fas fa-at"></i>
          <span>globalhajjandumrah</span>
        </div>
      </div>
      
      <div class="voucher-content">
        <div class="voucher-row">
          <div class="label">Date</div>
          <div class="value">: <span id="display-date">DD-MM-YYYY</span></div>
        </div>
        <div class="voucher-row">
          <div class="label">Client Name</div>
          <div class="value">: <span id="display-client-name">XXX</span></div>
        </div>
        <div class="voucher-row">
          <div class="label">Voucher No.</div>
          <div class="value">: <span id="display-voucher-no">AB-DDMMYY-HHMMSS</span></div>
        </div>
        <div class="voucher-row">
          <div class="label">Contact No.</div>
          <div class="value">: <span id="display-contact-no">XXX</span></div>
        </div>
        <div class="voucher-row">
          <div class="label">POS</div>
          <div class="value">: <span id="display-pos">XXX</span></div>
        </div>
        <div class="voucher-row">
          <div class="label">POS Contact No.</div>
          <div class="value">: <span id="display-pos-contact">XXX</span></div>
        </div>
        <div class="voucher-row">
          <div class="label">Saudi Contact Person</div>
          <div class="value">: <span>RAFIQ - +966 50 202 0679</span></div>
        </div>
        
        <div class="booking-details-header">Booking Details</div>
        
        <div id="display-bookings">
          </div>
        
        <div class="transport-details-header">Transport Details</div>
        
        <div id="display-transport">
          </div>
        
        <div class="policies-section">
          <div class="policies-title">Important Policies and Guidelines</div>
          <div class="policy-item">
            <span class="policy-number">1.</span>
            Your hotel and package are detailed in this document, and accommodation and other facilities will be provided to you accordingly.
          </div>
          <div class="policy-item">
            <span class="policy-number">2.</span>
            Carrying miscellaneous items to the Haramain Sharifain (the Two Holy Mosques) is prohibited by the Saudi administration. In case of a violation, the government can impose a fine, for which you will be responsible.
          </div>
          <div class="policy-item">
            <span class="policy-number">3.</span>
            The use of intoxicants and sheesha (hookah) is forbidden. The penalty for carrying narcotics into Saudi Arabia is death.
          </div>
          <div class="policy-item">
            <span class="policy-number">4.</span>
            Inside the Haramain Sharifain (Masjid al-Haram and Masjid an-Nabawi), you will be responsible for your belongings (money, mobile phone, etc.). Otherwise, you will face difficulties during your stay.
          </div>
          <div class="policy-item">
            <span class="policy-number">5.</span>
            At Jeddah airport, be sure to ask the immigration/Saudi sponsorship representative where you will be staying for 3 to 5 hours and inform your relatives who have come to see you off from your country of departure.
          </div>
          <div class="policy-item">
            <span class="policy-number">6.</span>
            After checking out of the hotel or building at 12 PM, any additional charges for Night Charge, Early Hotel Charge, or Late Check-out will be your responsibility.
          </div>
          <div class="policy-item">
            <span class="policy-number">7.</span>
            On your return flight, you are responsible for your luggage at the airport. You are responsible for informing the company about any forgotten luggage.
          </div>
          <div class="policy-item">
            <span class="policy-number">8.</span>
            According to Saudi law, working in a hotel other than your designated one is a crime. If you are caught by the police working in another hotel, you will be solely responsible for any legal consequences or resulting losses.
          </div>
          <div class="policy-item">
            <span class="policy-number">9.</span>
            All pilgrims are required to stay in their rooms from one day before their departure until their flight.
          </div>
          <div class="policy-item">
            <span class="policy-number">10.</span>
            Pilgrims whose passports and visas are with them should contact the staff in both countries and ensure they have a copy of their passport and visa with them at all times. Otherwise, the pilgrim will be responsible for any damages.
          </div>
          <div class="policy-item">
            <span class="policy-number">11.</span>
            All pilgrims, besides staying in their hotel rooms, should contact the staff at the provided number 36 hours before their flight to confirm their transport. Otherwise, other transportation will not be provided. In this case, the company will not be responsible.
          </div>
        </div>

        <div class="checkin-note">
          Checkin time is 4pm and Checkout time is 12pm
        </div>

      </div>
      
      <div class="voucher-footer"></div>
    </div>
    
    <div class="export-section">
      <button id="export-pdf" class="btn btn-export btn-blue">
        <i class="fas fa-file-pdf"></i> Export to PDF
      </button>
      <button id="export-jpg" class="btn btn-export btn-green">
        <i class="fas fa-file-image"></i> Export to JPG
      </button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize data
      let bookings = [];
      let transportSectors = [];
      let generatedData = {
        date: '',
        voucherNo: ''
      };
      
      // Generate Pakistan date (DD-MM-YYYY)
      function getPakistanDate() {
        const options = { timeZone: 'Asia/Karachi' };
        const now = new Date();
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const year = String(now.getFullYear()).slice(-2);
        return `${day}-${month}-${year}`;
      }
      
      // Generate voucher number
      function generateVoucherNo() {
        const now = new Date();
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const year = String(now.getFullYear()).slice(-2);
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        
        // Generate 2 random letters
        const randomLetters = Array(2).fill(0).map(() => 
          String.fromCharCode(65 + Math.floor(Math.random() * 26))
        ).join('');
        
        return `${randomLetters}-${day}${month}${year}-${hours}${minutes}${seconds}`;
      }
      
      // Generate reservation number
      function generateReservationNo() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        return `${hours}${minutes}${seconds}`;
      }
      
      // Calculate nights
      function calculateNights(checkIn, checkOut) {
        if (!checkIn || !checkOut) return '0';
        
        // Handle both date format (YYYY-MM-DD from input) and DD-MM-YYYY
        let dateIn, dateOut;
        
        if (checkIn.includes('-') && checkIn.length === 10) {
          if (checkIn.indexOf('-') === 4) { // YYYY-MM-DD
            const [yearIn, monthIn, dayIn] = checkIn.split('-');
            dateIn = new Date(yearIn, monthIn - 1, dayIn);
          } else { // DD-MM-YYYY
            const [dayIn, monthIn, yearIn] = checkIn.split('-');
            dateIn = new Date(yearIn, monthIn - 1, dayIn);
          }
        }
        
        if (checkOut.includes('-') && checkOut.length === 10) {
          if (checkOut.indexOf('-') === 4) { // YYYY-MM-DD
            const [yearOut, monthOut, dayOut] = checkOut.split('-');
            dateOut = new Date(yearOut, monthOut - 1, dayOut);
          } else { // DD-MM-YYYY
            const [dayOut, monthOut, yearOut] = checkOut.split('-');
            dateOut = new Date(yearOut, monthOut - 1, dayOut);
          }
        }
        
        if (!dateIn || !dateOut) return '0';
        
        const diffTime = dateOut - dateIn;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays > 0 ? diffDays.toString() : '0';
      }
      
      // Format date for display (convert YYYY-MM-DD to DD-MM-YYYY)
      function formatDateForDisplay(dateStr) {
        if (!dateStr) return 'DD-MM-YYYY';
        if (dateStr.indexOf('-') === 4) { // YYYY-MM-DD
          const [year, month, day] = dateStr.split('-');
          return `${day}-${month}-${year}`;
        }
        return dateStr;
      }
      
      // Initialize the form
      function initializeForm() {
        generatedData.date = getPakistanDate();
        generatedData.voucherNo = generateVoucherNo();
        
        document.getElementById('display-date').textContent = generatedData.date;
        document.getElementById('display-voucher-no').textContent = generatedData.voucherNo;
        
        // Add first booking
        addBooking();
        
        // Add first transport sector
        addTransportSector();
        
        // Initialize event listeners for vehicle and category
        document.getElementById('transport-vehicle').addEventListener('input', updateTransportDisplay);
        document.getElementById('transport-category').addEventListener('change', updateTransportDisplay);
      }
      
      // Create a new booking
      function addBooking() {
        const bookingIndex = bookings.length;
        const reservationNo = generateReservationNo();
        
        const booking = {
          city: 'Makkah',
          cityOther: '',
          hotelName: '',
          checkIn: '',
          checkOut: '',
          roomType: '',
          reservationNo: reservationNo
        };
        
        bookings.push(booking);
        renderBookings();
        renderBookingForm();
      }
      
      // Render booking forms
      function renderBookingForm() {
        const container = document.getElementById('bookings-container');
        container.innerHTML = '';
        
        bookings.forEach((booking, index) => {
          const bookingElement = document.createElement('div');
          bookingElement.className = 'booking-item';
          bookingElement.innerHTML = `
            <div class="booking-header">
              <div class="booking-title">Booking ${index + 1}</div>
              ${index > 0 ? `<button class="btn btn-danger remove-booking" data-index="${index}">Remove</button>` : ''}
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>City</label>
                <select class="form-control booking-city" data-index="${index}">
                  <option value="Makkah" ${booking.city === 'Makkah' ? 'selected' : ''}>Makkah</option>
                  <option value="Medina" ${booking.city === 'Medina' ? 'selected' : ''}>Medina</option>
                  <option value="Other" ${booking.city === 'Other' ? 'selected' : ''}>Other</option>
                </select>
                <div class="other-city-input" id="other-city-${index}" style="${booking.city === 'Other' ? 'display: block;' : 'display: none;'}">
                  <input type="text" class="form-control other-city-name" data-index="${index}" placeholder="Specify City Name" value="${booking.cityOther}">
                </div>
              </div>
              <div class="form-group">
                <label>Hotel Name</label>
                <input type="text" class="form-control booking-hotel" data-index="${index}" placeholder="Enter Hotel Name" value="${booking.hotelName}">
              </div>
              <div class="form-group">
                <label>Check-In</label>
                <input type="date" class="form-control booking-checkin" data-index="${index}" value="${booking.checkIn}">
              </div>
              <div class="form-group">
                <label>Check-Out</label>
                <input type="date" class="form-control booking-checkout" data-index="${index}" value="${booking.checkOut}">
              </div>
              <div class="form-group">
                <label>Room Type</label>
                <input type="text" class="form-control booking-roomtype" data-index="${index}" placeholder="Enter Room Type" value="${booking.roomType}">
              </div>
              <div class="form-group">
                <label>Nights</label>
                <input type="text" class="form-control" value="${calculateNights(booking.checkIn, booking.checkOut)}" readonly>
              </div>
            </div>
          `;
          
          container.appendChild(bookingElement);
        });
        
        // Add event listeners
        document.querySelectorAll('.booking-city').forEach(el => {
          el.addEventListener('change', function() {
            const index = parseInt(this.dataset.index);
            bookings[index].city = this.value;
            
            // Show/hide other city input
            const otherCityInput = document.getElementById(`other-city-${index}`);
            if (this.value === 'Other') {
              otherCityInput.style.display = 'block';
            } else {
              otherCityInput.style.display = 'none';
              bookings[index].cityOther = '';
            }
            
            renderBookings();
          });
        });
        
        document.querySelectorAll('.other-city-name').forEach(el => {
          el.addEventListener('input', function() {
            const index = parseInt(this.dataset.index);
            bookings[index].cityOther = this.value;
            renderBookings();
          });
        });
        
        document.querySelectorAll('.booking-hotel').forEach(el => {
          el.addEventListener('input', function() {
            const index = parseInt(this.dataset.index);
            bookings[index].hotelName = this.value;
            renderBookings();
          });
        });
        
        document.querySelectorAll('.booking-checkin').forEach(el => {
          el.addEventListener('change', function() {
            const index = parseInt(this.dataset.index);
            bookings[index].checkIn = this.value;
            bookings[index].reservationNo = generateReservationNo();
            renderBookings();
          });
        });
        
        document.querySelectorAll('.booking-checkout').forEach(el => {
          el.addEventListener('change', function() {
            const index = parseInt(this.dataset.index);
            bookings[index].checkOut = this.value;
            renderBookings();
          });
        });
        
        document.querySelectorAll('.booking-roomtype').forEach(el => {
          el.addEventListener('input', function() {
            const index = parseInt(this.dataset.index);
            bookings[index].roomType = this.value;
            renderBookings();
          });
        });
        
        document.querySelectorAll('.remove-booking').forEach(el => {
          el.addEventListener('click', function() {
            const index = parseInt(this.dataset.index);
            bookings.splice(index, 1);
            renderBookingForm();
            renderBookings();
          });
        });
      }
      
      // Render bookings in voucher preview
      function renderBookings() {
        const container = document.getElementById('display-bookings');
        container.innerHTML = '';
        
        bookings.forEach((booking, index) => {
          // Determine display city name
          let displayCity = booking.city;
          if (booking.city === 'Other' && booking.cityOther) {
            displayCity = booking.cityOther;
          }
          
          const bookingTable = document.createElement('div');
          bookingTable.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <div style="font-weight: 700; font-size: 18px;">City : ${displayCity}</div>
              <div style="font-weight: 700; font-size: 18px;">Hotel Name : ${booking.hotelName || 'XXX'}</div>
            </div>
            <table class="booking-table">
              <thead>
                <tr>
                  <th>Reservation No.</th>
                  <th>Nights</th>
                  <th>Check-In</th>
                  <th>Check-Out</th>
                  <th>Room Type</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>${booking.reservationNo}</td>
                  <td>${calculateNights(booking.checkIn, booking.checkOut)}</td>
                  <td>${formatDateForDisplay(booking.checkIn)}</td>
                  <td>${formatDateForDisplay(booking.checkOut)}</td>
                  <td>${booking.roomType || 'XXX'}</td>
                </tr>
              </tbody>
            </table>
          `;
          
          container.appendChild(bookingTable);
        });
      }
      
      // Add a new transport sector
      function addTransportSector() {
        const sectorIndex = transportSectors.length;
        
        const sectorContainer = document.getElementById('sectors-container');
        const sectorElement = document.createElement('div');
        sectorElement.className = 'sector-input-container';
        sectorElement.innerHTML = `
          <input type="text" class="sector-input" placeholder="Enter Sector ${sectorIndex + 1}" data-index="${sectorIndex}">
          <button class="add-sector-btn" id="add-sector-${sectorIndex}">
            <i class="fas fa-plus"></i>
          </button>
        `;
        
        sectorContainer.appendChild(sectorElement);
        
        // Add event listener to the input
        const input = sectorElement.querySelector('.sector-input');
        input.addEventListener('input', function() {
          const index = parseInt(this.dataset.index);
          if (index >= transportSectors.length) {
            // Extend array if needed
            while (transportSectors.length <= index) {
              transportSectors.push('');
            }
          }
          transportSectors[index] = this.value;
          updateTransportDisplay();
        });
        
        // Add event listener to the add button
        const addButton = sectorElement.querySelector('.add-sector-btn');
        addButton.addEventListener('click', function() {
          addTransportSector();
        });
        
        // Initialize the sector in the array
        if (sectorIndex >= transportSectors.length) {
          transportSectors.push('');
        }
      }
      
      // Update transport display in voucher
      function updateTransportDisplay() {
        const container = document.getElementById('display-transport');
        container.innerHTML = '';
        
        // Filter out empty sectors
        const filledSectors = transportSectors.filter(sector => sector.trim() !== '');
        
        if (filledSectors.length > 0) {
          const transportTable = document.createElement('table');
          transportTable.className = 'transport-table';
          transportTable.innerHTML = `
            <thead>
              <tr>
                <th>Sectors</th>
                <th>Vehicle</th>
                <th>Category</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>${filledSectors.join(' - ')}</td>
                <td>${document.getElementById('transport-vehicle').value || '---'}</td>
                <td>${document.getElementById('transport-category').value}</td>
              </tr>
            </tbody>
          `;
          
          container.appendChild(transportTable);
        }
      }
      
      // Update voucher display with form data
      function updateVoucherDisplay() {
        document.getElementById('display-client-name').textContent = document.getElementById('clientName').value || 'XXX';
        document.getElementById('display-contact-no').textContent = document.getElementById('contactNo').value || 'XXX';
        document.getElementById('display-pos').textContent = document.getElementById('pos').value || 'XXX';
        document.getElementById('display-pos-contact').textContent = document.getElementById('posContactNo').value || 'XXX';
      }
      
      // Export to PDF
      document.getElementById('export-pdf').addEventListener('click', function() {
        const button = this;
        const originalHTML = button.innerHTML;
        button.disabled = true;
        button.innerHTML = '<span class="loading"></span> Generating...';
        
        // Update display with current form values
        updateVoucherDisplay();
        updateTransportDisplay();
        
        setTimeout(() => {
          const element = document.getElementById('voucher-preview');
          
          html2canvas(element, {
            scale: 2,
            useCORS: true,
            allowTaint: true
          }).then(canvas => {
            // Convert to JPEG with 0.75 quality to reduce file size significantly
            const imgData = canvas.toDataURL('image/jpeg', 0.75);
            const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
            
            const imgWidth = 210; // A4 width in mm
            const pageHeight = 297; // A4 height in mm
            const imgHeight = canvas.height * imgWidth / canvas.width;
            
            pdf.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
            
            // Set Dynamic Filename
            const voucherNo = generatedData.voucherNo;
            const clientName = document.getElementById('clientName').value.trim() || 'Client';
            pdf.save(`${voucherNo}_${clientName}.pdf`);
            
            button.disabled = false;
            button.innerHTML = originalHTML;
          }).catch(error => {
            console.error('Error generating PDF:', error);
            alert('Error generating PDF. Please try again.');
            button.disabled = false;
            button.innerHTML = originalHTML;
          });
        }, 500);
      });
      
      // Export to JPG
      document.getElementById('export-jpg').addEventListener('click', function() {
        const button = this;
        const originalHTML = button.innerHTML;
        button.disabled = true;
        button.innerHTML = '<span class="loading"></span> Generating...';
        
        // Update display with current form values
        updateVoucherDisplay();
        updateTransportDisplay();
        
        setTimeout(() => {
          const element = document.getElementById('voucher-preview');
          
          html2canvas(element, {
            scale: 2,
            useCORS: true,
            allowTaint: true
          }).then(canvas => {
            const link = document.createElement('a');
            
            // Set Dynamic Filename
            const voucherNo = generatedData.voucherNo;
            const clientName = document.getElementById('clientName').value.trim() || 'Client';
            link.download = `${voucherNo}_${clientName}.jpg`;
            
            // Export as JPEG with 0.8 quality
            link.href = canvas.toDataURL('image/jpeg', 0.8);
            link.click();
            
            button.disabled = false;
            button.innerHTML = originalHTML;
          }).catch(error => {
            console.error('Error generating JPG:', error);
            alert('Error generating JPG. Please try again.');
            button.disabled = false;
            button.innerHTML = originalHTML;
          });
        }, 500);
      });
      
      // Add booking button
      document.getElementById('add-booking').addEventListener('click', addBooking);
      
      // Form field event listeners
      document.getElementById('pos').addEventListener('input', updateVoucherDisplay);
      document.getElementById('posContactNo').addEventListener('input', updateVoucherDisplay);
      document.getElementById('clientName').addEventListener('input', updateVoucherDisplay);
      document.getElementById('contactNo').addEventListener('input', updateVoucherDisplay);
      
      // Initialize the app
      initializeForm();
    });
  </script>
</body>
</html>
